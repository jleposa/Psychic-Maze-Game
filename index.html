
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Psychic Maze Game</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: #000;
      font-family: 'Garamond', serif;
      color: white;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border: 2px solid lime;
      max-width: 400px;
    }
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: black;
      color: lime;
      padding: 30px;
      border: 2px solid lime;
      font-size: 1.5em;
      display: none;
      z-index: 20;
    }
  </style>
</head>
<body>
  <div id="ui">
    <div><strong>Psychic Maze Game</strong></div>
    <div>Orbs: <span id="orbs">0</span> | Powers: <span id="powers">None</span></div>
    <div><strong>Controls:</strong><br>
      Move: W/A/S/D<br>
      Look: Mouse<br>
      Clairvoyance: C (after 2 orbs)
    </div>
  </div>
  <div id="message">You found the exit!</div>
  <div id="container"></div>
  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.155.0/build/three.module.js';
    import { PointerLockControls } from 'https://unpkg.com/three@0.155.0/examples/jsm/controls/PointerLockControls.js';

    let scene, camera, renderer, controls;
    let move = {f:0,b:0,l:0,r:0}, orbs = [], powers = [], orbCount = 0, clairvoyanceUsed = false;
    const tile = 10, walls = [], powerUps = [], EXIT = new THREE.Vector3();

    const MAZE = [
      "##########",
      "#P..I...E#",
      "#.####.#.#",
      "#...D..#.#",
      "#.##.#...#",
      "#...##.I.#",
      "#I..D....#",
      "##########"
    ];

    init();
    animate();

    function init() {
      const container = document.body;
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({antialias: true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      container.appendChild(renderer.domElement);

      controls = new PointerLockControls(camera, document.body);
      document.body.addEventListener('click', () => controls.lock());
      scene.add(controls.getObject());

      scene.add(new THREE.HemisphereLight(0xffffcc, 0x202020, 1.5));

      MAZE.forEach((row,z)=>{
        [...row].forEach((ch,x)=>{
          const px = (x - MAZE[0].length/2)*tile;
          const pz = (z - MAZE.length/2)*tile;
          if(ch === '#') {
            const wall = new THREE.Mesh(new THREE.BoxGeometry(tile,10,tile), new THREE.MeshLambertMaterial({color:0x222222}));
            wall.position.set(px,5,pz);
            scene.add(wall); walls.push(wall);
          } else if(ch === 'I') {
            const orb = new THREE.Mesh(new THREE.SphereGeometry(2,16,16), new THREE.MeshBasicMaterial({color:0xffff00}));
            orb.position.set(px,2,pz); scene.add(orb); orbs.push(orb);
          } else if(ch === 'P') {
            controls.getObject().position.set(px,2,pz);
          } else if(ch === 'E') {
            const exit = new THREE.Mesh(new THREE.CylinderGeometry(3,3,1,16), new THREE.MeshBasicMaterial({color:0x00ff00}));
            exit.position.set(px,0.5,pz); scene.add(exit); EXIT.set(px,0.5,pz);
          } else if(ch === 'D') {
            const door = new THREE.Mesh(new THREE.BoxGeometry(tile,10,tile), new THREE.MeshLambertMaterial({color:0x5555aa}));
            door.name = "door"; door.position.set(px,5,pz);
            scene.add(door); walls.push(door);
          }
        });
      });

      window.addEventListener('resize',()=>{
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      window.addEventListener('keydown',e=>{
        if(e.code === 'KeyW') move.f=1;
        if(e.code === 'KeyS') move.b=1;
        if(e.code === 'KeyA') move.l=1;
        if(e.code === 'KeyD') move.r=1;
        if(e.code === 'KeyC' && orbCount >= 2 && !clairvoyanceUsed){
          clairvoyanceUsed = true;
          const affected = walls.filter(w=>w.name === "door");
          affected.forEach(w=>scene.remove(w));
          document.getElementById('powers').textContent = "Clairvoyance used";
        }
      });
      window.addEventListener('keyup',e=>{
        if(e.code === 'KeyW') move.f=0;
        if(e.code === 'KeyS') move.b=0;
        if(e.code === 'KeyA') move.l=0;
        if(e.code === 'KeyD') move.r=0;
      });
    }

    function animate() {
      requestAnimationFrame(animate);
      if(controls.isLocked){
        const speed = 0.2;
        if(move.f) controls.moveForward(speed);
        if(move.b) controls.moveForward(-speed);
        if(move.l) controls.moveRight(-speed);
        if(move.r) controls.moveRight(speed);

        orbs.slice().forEach((o,i)=>{
          if(controls.getObject().position.distanceTo(o.position)<3){
            scene.remove(o); orbs.splice(i,1); orbCount++;
            document.getElementById('orbs').textContent = orbCount;
            if(orbCount >= 2) document.getElementById('powers').textContent = "Clairvoyance unlocked (press C)";
          }
        });

        if(controls.getObject().position.distanceTo(EXIT)<4){
          document.getElementById('message').style.display='block';
          controls.unlock();
        }
      }
      renderer.render(scene, camera);
    }
  </script>
</body>
</html>
